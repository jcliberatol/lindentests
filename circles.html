<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r73/three.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.js"></script>
	<link href='https://fonts.googleapis.com/css?family=Titillium+Web:400,700italic,700,400italic' rel='stylesheet' type='text/css'>
</head>


<body style="font-family: 'Titillium Web', sans-serif;">
	<div style="border: solid; border-width:3px;overflow:hidden" class="frame">
		<div style="overflow:hidden;padding:5px">
			<h2 style="text-align:center">Improper Fractions to Mixed Fractions</h2>
			<div style="width:30%;height:20%">
				<div style="height:100%;margin:7px;padding:7px"><h3>Num: <input class="num"></input></h3>
					<h3>Den: <input class="den"></input></h3>

					<button class="draw">Draw </button></div>
					<div style="height=100%;margin:7px;padding:7px;overflow:hidden;padding:2px;width:50%;text-align:left">
						<h3>Mixed Fraction : </h3><div class="fraction" style="font-size:20px"></div>
						<h3>Decimal : </h3><div class="decimal" style="font-size:20px"></div>
					</div>
			</div>

			</div>
		</div>

	</body>
	<script>

	var scene, camera, renderer;
	var geometry, material, mesh;

	init();
	animate();

	//Funcion de click que dispara los cambios en la escena
	$('.draw').bind('click',draw);

	function draw(){
		// Limpia la escena
		for (var i = scene.children.length; i > 0; i--) {
			scene.remove(scene.children[i-1]);
		}
		//Inicializa la escena con las luces.
		initscene();
		num = $('.num').get(0);
		den = $('.den').get(0);
		numval = parseInt(num.value)
		denval = parseInt(den.value)
		decimal = numval/denval;
		console.log(decimal);
		nummix = numval - Math.floor(decimal)*denval;
		console.log(Math.floor(decimal));
		console.log(nummix);
		console.log(denval);

		element = $('.fraction').get(0);
		katex.render(Math.floor(decimal)+"\\frac{"+nummix+"}{"+denval+"}",element);

		element = $('.decimal').get(0);
		katex.render(decimal+" ", element);


		//Draw the grid
		cells = Math.ceil(decimal);
		quadside = Math.ceil(Math.sqrt(cells));

		grid = new THREE.GridHelper( quadside / 2 , 1 );
		grid.rotation.x = Math.PI/2
		scene.add( grid );
		camera.position.z = quadside
		console.log(material);
		for (var i = 0; i < cells; i++) {
			material = new THREE.MeshPhongMaterial( {
				color: 0x996633,
				specular: 0x050505,
				shininess: 100
			} )
			var radius = 0.3;
			var segments = denval;
			thetast = Math.PI;
			thetalen = 2*Math.PI;

			if(i == Math.floor(decimal)){
				console.log((decimal - Math.floor(decimal)));
				segments = nummix;
				thetalen = thetalen * (decimal - Math.floor(decimal))
			}
			var circleGeometry = new THREE.CircleGeometry( radius, 32 , thetast , thetalen);
			var circle = new THREE.Mesh( circleGeometry, material );
			if( segments < 15) {

				// para de 1 a thetalen hacer una linea por cada uno.
				var material = new THREE.LineBasicMaterial({
					color: 0xffffff
				});

				for (var j = 0; j < segments; j++) {
					theta = 2 * Math.PI;
					theta = (j) * theta / denval;

					var geometry = new THREE.Geometry();
					geometry.vertices.push(new THREE.Vector3(0, 0, 0));
					geometry.vertices.push(new THREE.Vector3(Math.cos(theta), Math.sin(theta), 0));
					var line = new THREE.Line(geometry, material);
					line.scale.set(radius,radius,radius);
					line.rotation.z = Math.PI;
					circle.add(line);
				}



			}
			else{

				wireMaterial = new THREE.MeshBasicMaterial({color : '#ffffff' , wireframe : true})
				var circleGeometry2 = new THREE.CircleGeometry( radius, segments , thetast , thetalen);
				circleMesh = new THREE.Mesh(circleGeometry2 , wireMaterial );
				circleMesh.scale.set(1.2,1.2,1.2);
				circle.add(circleMesh);
			}



			scene.add( circle );
			factor = quadside / 2 - 0.5
			circle.position.y = -Math.floor(i/quadside) + factor
			circle.position.x = i - Math.floor(i/quadside)*quadside -factor;



		}

	}
	function initscene(){

		//inicializar las luces
		lights = [];
		lights[0] = new THREE.PointLight( 0xffffff, 1, 0 );
		lights[1] = new THREE.PointLight( 0xffffff, 1, 0 );
		lights[2] = new THREE.PointLight( 0xffffff, 1, 0 );
		lights[1].position.copy(camera.position);
		lights[1].position.z += 50
		lights[1].position.y += 50
		lights[1].position.x += 50

		scene.add( lights[0] );
		scene.add( lights[1] );
		scene.add( lights[2] );

		//crear el material de los discos
		material = new THREE.MeshPhongMaterial( {
			color: 0x996633,
			specular: 0x050505,
			shininess: 100
		} )
	}
	function init() {

		scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera( 75, window.innerWidth / (window.innerHeight), 1, 10000 );
		camera.position.z = 10;
		initscene();
		var radius = 5;
		var segments = 32;
		time=0;

		var circleGeometry = new THREE.CircleGeometry( radius, segments );
		circle = new THREE.Mesh( circleGeometry, material );
		scene.add( circle );


		renderer = new THREE.WebGLRenderer( {alpha : true , antialias: true} );
		renderer.setSize( window.innerWidth ,window.innerHeight );
		document.body.appendChild( renderer.domElement );
		$('canvas').css('position','fixed').css('top','0px').css('left','0px').css("z-index",-1)
		$('.frame').height($('canvas').height() - 30 );
	}

	function animate() {
		requestAnimationFrame( animate );
		renderer.render( scene, camera );
		time += 0.1;
		lights[0].position.set(Math.sin(time*0.1)*5,Math.cos(time*0.1)*5,2);
	}

	</script>
	</html>
